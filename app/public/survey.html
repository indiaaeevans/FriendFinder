<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Survey</title>
	<!--Import Google Font Material Icons-->
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<!-- Compiled and minified CSS -->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="css/style.css">
  	<!--Import jQuery-->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- Materialize Compiled and minified JavaScript -->
    <script type="text/javascript" src="js/materialize.min.js"></script>
</head>
<body>

<div class="container">
<!-- PAGE HEADER -->
<div class="row">
	<header class="col s12">
		<h1>Survey</h1>
		<hr class="horizontalrule">
	</header>
</div>
<!-- ABOUT YOU SECTION -->
<div class="row">
    <form class="col s12">
      <div class="row">
        <div class="input-field col s6">
          <i class="material-icons prefix">account_circle</i>
          <input id="name" type="text" class="validate">
          <label for="name">Name</label>
        </div>
        <div class="input-field col s6">
          <i class="material-icons prefix">picture_in_picture</i>
          <input id="imageLink" type="tel" class="validate">
          <label for="imageLink">Link to Photo Image</label>
        </div>
      </div>
    </form>
  </div>

	<!-- Survey Questions -->
<form id="form">
<div class="row">
	<div class="input-field col s12">
    <select id="q1">
      <option value="" disabled selected>Choose your option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <label>Your mind is always buzzing with unexplored ideas and plans.</label>
  </div>
</div>
<div class="row">
	<div class="input-field col s12">
    <select id="q2">
      <option value="" disabled selected>Choose your option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <label>Generally speaking, you rely more on your experience than your imagination.</label>
  </div>
</div>
<div class="row">
	<div class="input-field col s12">
    <select id="q3">
      <option value="" disabled selected>Choose your option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <label>You find it easy to stay relaxed and focused even when there is some pressure.</label>
  </div>
</div>
<div class="row">
	<div class="input-field col s12">
    <select id="q4">
      <option value="" disabled selected>Choose your option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <label>You rarely do something just out of sheer curiosity.</label>
  </div>
</div>
<div class="row">
	<div class="input-field col s12">
    <select id="q5">
      <option value="" disabled selected>Choose your option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <label>People can rarely upset you.</label>
  </div>
</div>
</form>

<div class="row">
<!-- SUBMIT BUTTON -->
	<button class="col s6 btn waves-effect waves-light light-blue accent-3 disabled"
	type="submit" id="submit" name="action">Submit<i class="material-icons right">input</i>
	</button>
<!-- CLEAR FORM BUTTON -->
	<button class="col s2 right btn waves-effect waves-light light-blue accent-3"
	type="submit" id="clear" name="action">Clear<i class="material-icons right">clear_all</i>
	</button>	
</div>

</div>
<!-- Sticky Footer -->
    <footer class="footer">
        <div class="container">
			<span><a class="footerLinks" href="/api/friends">API Friends List</a> | <a class="footerLinks" href="#">GitHub Repo</a></span>
            <!-- <span class="text-muted">Copyright &copy; 2017 - UNC Coding Bootcamp</span> -->
        </div>
    </footer>

<script type="text/javascript">
	// initialize the form (materialize)
	$(document).ready(function() {
	    $('select').material_select();
	});

	// submit button is disabled until all questions are answered
	function checkForm() {
		var questionAnswered = [];
		// check if the user has selected an answer for each question
		$('#form').find('select').each(function(){
		  if ($(this).val()){
		  	questionAnswered.push("true");
		  }
		});
		// if all questions have been answered, enable the submit button
		if (questionAnswered.length === 5 && $("#name").val() && $("#imageLink").val()) {
			$("#submit").removeClass("disabled");
		}
	}

	$("form").change(checkForm);

	// constructor to save user data
	function user(name, photo, survey){
		this.name = name,
		this.photo = photo,
		this.survey = survey
	}
	
	// On submit, create a new user
	$("#submit").on("click", function(event) {

	    event.preventDefault();

	    // Convert survey results into a simple array of numbers 
	    var survey = [];
		$('#form').find('select').each(function(){
			var answer = $(this).val();
			survey.push(parseInt(answer));
		});

		// save text inputs
		var name = $("#name").val();
		var photo = $("#imageLink").val();

		// create new user
		var newUser = new user(name, photo, survey);

		// send the object to the friends data
		$.post("/api/friends", newUser, function(data) {
			if (data) {
				alert("new user added");
			}
        });

        // Clear the form after submitting
        clearForm();
        resetMaterial();
	});

	var select = $('select');

	// clear button will clear out the form
	$("#clear").on("click", function(event) {
		event.preventDefault();
		clearForm();
		resetMaterial();
	});

	function clearForm() {
		// clear out the text input fields
		$("form input").val("");
		//Sets the first option in dropdown as selected
	    select.prop('selectedIndex', 0);
	    //Update material select
	    select.material_select();		
	}

	function resetMaterial() {
		select.material_select();
	}


	function friendQuery() {
		var currentURL = window.location.origin;
		$.ajax({url: currentURL + "/api/friends", method: "GET"})
			.done(function(friends) {

				console.log("URL: " + "/api/friends");
				
		})
	}

</script>
</body>
</html>